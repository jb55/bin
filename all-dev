#!/usr/bin/env bash

nix-path () {
    nix-instantiate --eval --expr 'with import <nixpkgs> {}; "${'"$1"'}"' | sed 's/"//g'
}

RUST_SRC_PATH="$(nix-path rustChannels.nightly.rust-src)/lib/rustlib/src/rust/src"
export RUST_SRC_PATH

exec nix-shell -p \
     asciidoc \
     libgit2 \
     autoconf \
     rustChannels.nightly.rust \
     rustracer \
     autogen \
     automake \
     bison \
     cairo \
     clang \
     cppcheck \
     dotnet-sdk \
     elmPackages.elm \
     flex \
     gdb \
     git \
     glfw \
     glib \
     gmp \
     gtk3 \
     haskellEnv \
     imagemagick \
     libical \
     librsvg \
     libtool \
     libxml2 \
     mesa_noglu \
     nodejs \
     pkgconfig \
     'python3.withPackages (p: with p; [bitcoinlib sphinx pytest-forked pytest_xdist pytest ephemeral_port_reserve flaky flake8])' \
     qrencode \
     SDL2 \
     sqlite \
     tor \
     valgrind \
     xorg.libX11.{man,dev} \
     xorg.libXft \
     zlib \
     "$@"
